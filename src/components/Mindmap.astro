---
import * as d3 from "d3";
---

<div id="mindmap-container" class="w-full h-[600px] overflow-auto"></div>

<script>
  const data = {
    name: "IT-Grundlagen Modul",
    children: [
      {
        name: "Einführung und Überblick",
        children: [
          { name: "Organisatorisches" },
          { name: "Kommunikationsschema" },
          { name: "Big Picture & Anwendungen" },
        ],
      },
      {
        name: "Zahlensysteme und Logikschaltungen",
        children: [
          { name: "Zahlensysteme" },
          { name: "Boolesche Algebra" },
          { name: "Binärsystem" },
        ],
      },
    ],
  };

  document.addEventListener("DOMContentLoaded", () => {
    const width = 1000;
    const dx = 25;
    const dy = 200;

    const tree = d3.tree().nodeSize([dx, dy]);
    const diagonal = d3.linkHorizontal().x(d => d.y).y(d => d.x);

    const root = d3.hierarchy(data);
    root.x0 = 0;
    root.y0 = 0;

    root.descendants().forEach((d, i) => {
      d.id = i;
      d._children = d.children;
      if (d.depth > 0) d.children = null;
    });

    const container = d3.select("#mindmap-container");

    const svg = container
      .append("svg")
      .attr("width", "100%")
      .attr("height", 600);

    const g = svg.append("g").attr("transform", "translate(100,50)");

    function update(source) {
      tree(root);

      const nodes = root.descendants();
      const links = root.links();

      const node = g.selectAll("g.node").data(nodes, d => d.id);

      const nodeEnter = node
        .enter()
        .append("g")
        .attr("class", "node")
        .attr("transform", `translate(${source.y0},${source.x0})`)
        .on("click", (event, d) => {
          d.children = d.children ? null : d._children;
          update(d);
        });

      nodeEnter
        .append("circle")
        .attr("r", 8)
        .attr("fill", d => (d._children ? "#7c3aed" : "#aaa"));

      nodeEnter
        .append("text")
        .attr("dy", "0.35em")
        .attr("x", 15)
        .text(d => d.data.name)
        .style("font-size", "14px");

      nodeEnter
        .merge(node)
        .transition()
        .attr("transform", d => `translate(${d.y},${d.x})`);

      node.exit().remove();

      const link = g.selectAll("path.link").data(links, d => d.target.id);

      link
        .enter()
        .append("path")
        .attr("class", "link")
        .attr("fill", "none")
        .attr("stroke", "#ccc")
        .attr("stroke-width", 2)
        .merge(link)
        .transition()
        .attr("d", diagonal);

      link.exit().remove();

      root.eachBefore(d => {
        d.x0 = d.x;
        d.y0 = d.y;
      });
    }

    update(root);
  });
</script>