---
import TiltCard from './TiltCard.astro';

interface Module {
  title: string;
  desc: string | string[];
  color: string;
  emoji: string;
  label: string;
}

interface Props {
  modules: Module[];
}

const { modules } = Astro.props;
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 px-4 max-w-7xl mx-auto">
  {modules.map((mod, i) => (
    <div 
      class="module-card-trigger cursor-pointer h-[300px]" 
      data-title={mod.title} 
      data-desc={JSON.stringify(mod.desc)}
      data-num={i + 1}
      data-label={mod.label}
    >
      <TiltCard 
        modNumber={(i + 1).toString()}
        title={mod.title}
        desc={mod.desc}
        colorClass={mod.color}
        emoji={mod.emoji}
        label={mod.label}
      />
    </div>
  ))}
</div>

<div id="module-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/60 backdrop-blur-md opacity-0 transition-opacity duration-300">
  <div class="modal-content bg-white border-4 border-black rounded-[2.5rem] shadow-[12px_12px_0px_#000] max-w-2xl w-full p-8 md:p-12 relative scale-90 transition-transform duration-300">
    
    <button id="close-modal" class="absolute top-6 right-6 w-10 h-10 flex items-center justify-center bg-gray-100 rounded-full hover:bg-red-100 hover:text-red-600 transition-colors font-bold text-xl">✕</button>
    
    <div id="modal-badge" class="inline-block px-4 py-1.5 mb-6 text-sm font-black tracking-widest text-white uppercase bg-purple-600 rounded-full border-2 border-black shadow-[3px_3px_0px_#000]">
      MODUL 0
    </div>
    
    <h2 id="modal-title" class="text-3xl md:text-4xl font-black italic uppercase mb-8 text-gray-900 leading-none tracking-tighter">
      TITULO DEL MODULO
    </h2>

    <div id="modal-desc" class="space-y-4 text-lg font-medium text-gray-700">
      </div>
  </div>
</div>

<script>
  const modal = document.getElementById('module-modal');
  const modalContent = modal?.querySelector('.modal-content');
  const closeBtn = document.getElementById('close-modal');
  const triggers = document.querySelectorAll('.module-card-trigger');

  const modalTitle = document.getElementById('modal-title');
  const modalDesc = document.getElementById('modal-desc');
  const modalBadge = document.getElementById('modal-badge');

  function openModal(data) {
    if (!modal || !modalTitle || !modalDesc || !modalBadge) return;

    // Inyectar datos
    modalTitle.innerText = data.title;
    modalBadge.innerText = `${data.label} ${data.num}`;
    
    // Limpiar y construir descripción
    modalDesc.innerHTML = '';
    const descData = JSON.parse(data.desc);

    if (Array.isArray(descData)) {
      const ul = document.createElement('ul');
      ul.className = 'space-y-3';
      descData.forEach(item => {
        const li = document.createElement('li');
        li.className = 'flex gap-3 leading-tight';
        li.innerHTML = `<span class="text-purple-600 font-bold">•</span> <span>${item}</span>`;
        ul.appendChild(li);
      });
      modalDesc.appendChild(ul);
    } else {
      modalDesc.innerHTML = `<p>${descData}</p>`;
    }

    // Animación de entrada
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    setTimeout(() => {
      modal.classList.add('opacity-100');
      modalContent?.classList.add('scale-100');
    }, 10);
    document.body.style.overflow = 'hidden'; // Bloquear scroll
  }

  function closeModal() {
    modal?.classList.remove('opacity-100');
    modalContent?.classList.remove('scale-100');
    setTimeout(() => {
      modal?.classList.add('hidden');
      modal?.classList.remove('flex');
      document.body.style.overflow = 'auto';
    }, 300);
  }

  triggers.forEach(trigger => {
    trigger.addEventListener('click', () => {
      openModal((trigger as HTMLElement).dataset);
    });
  });

  closeBtn?.addEventListener('click', closeModal);
  
  // Cerrar al clickear fuera
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });
</script>